# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

`micoo` (mise cookbooks) is a Python CLI tool for accessing [mise](https://github.com/jdx/mise) configuration templates from [mise-cookbooks](https://github.com/hasansezertasan/mise-cookbooks). Built with Typer, it clones/updates a cookbook repository locally and provides commands to list, search, and dump cookbook configurations.

## Development Commands

```sh
# Install dependencies
uv sync

# Run the full CI pipeline (all Python versions + style checks)
uv run --locked tox run

# Run style checks only (linting, type checking, formatting)
uv run --locked tox run -e style

# Run tests for current Python version
pytest tests/

# Run a single test
pytest tests/test_main.py::test_version

# Run the CLI locally
uv run micoo version
uv run micoo --help

# Generate PyPI README preview
uv run hatch-fancy-pypi-readme -o PyPI.md
```

## Architecture

### Source Layout (`src/micoo/`)

- **`main.py`** - All CLI commands via Typer app. Entry point: `app = typer.Typer()`
- **`config.py`** - Platform-specific paths using `platformdirs` (cache, logs) and constants (repo URLs, file extension)
- **`logging_setup.py`** - Rotating file handler + stderr console handler for errors
- **`_version.py`** - Auto-generated by hatch-vcs from git tags

### Key Patterns

- Commands use `ensure_repository_exists()` guard to check if cookbooks are cloned
- GitPython (`Repo`) handles clone/pull operations
- Cookbooks are `.mise.toml` files in the cached repository
- `prepare_cookbook()` wraps cookbook content with header containing source URL and commit hash

### Testing

Tests use `typer.testing.CliRunner` to invoke commands. Some tests have dependencies (e.g., `test_list` depends on `test_update` having cloned the repo first) via `@pytest.mark.dependency`.

## Code Quality

- **Ruff**: Primary linter/formatter with `ALL` rules, preview mode, target Python 3.14
- **Type checking**: mypy (strict), pyright, ty, pyrefly - all four run for defense-in-depth
- **Vulture**: Dead code detection (ignores `@app.command` decorators)
- **Max complexity**: McCabe complexity limit of 5
- **Docstrings**: Google convention

## Python Version

**Python 3.14+ only**. See [ADR-001](docs/adr/001-development-tooling.md) for rationale. As a CLI tool distributed via pipx/uvx/Homebrew, the installation method provides Python.

## Versioning

Version is derived from git tags via hatch-vcs. No manual version bumping - just tag releases.

## Development Journal

See [JOURNAL.md](JOURNAL.md) for chronological decisions and rationale.
